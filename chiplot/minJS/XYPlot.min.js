import{MainPlot}from"/static/xiaochiPlot/minJS/mainplot.min.js";class XYPlot extends MainPlot{constructor(t=[]){super("data file");const o=this;this.patternsSVGArr=[{name:"hlines",svg:"<line y1='2' y2='2' x2=\"100\" ></line>"},{name:"vlines",svg:"<line x1='2' x2='2' y2=\"100\" ></line>"},{name:"nelines",svg:"<line y1='2' y2='2' x2=\"100\" ></line>",patternTransform:"rotate(-45)"},{name:"nwlines",svg:"<line y1='2' y2='2' x2=\"100\" ></line>",patternTransform:"rotate(45)"},{name:"circle",svg:"<circle cx='3' cy='3' r='2' ></circle>"},{name:"wall",svg:"<path d='M0 6h8v4H0zm4-4h8v4H4m-8-4h8v4h-8zm4-4h8v4H0z'   fill='none'/>",width:8,height:8},{name:"herringbone",svg:"<path d='M7.5 2.5h5v15H7.5zM17.5-2.5V2.5H2.5V-2.5zM17.5 17.5v5H2.5V17.5zM17.5-7.5h5v15H17.5zM27.5 7.5v5H12.5V7.5zM7.5 7.5v5h-15V7.5zM17.5 12.5h5v15H17.5zM-2.5 12.5H2.5v15H-2.5zM-2.5-7.5H2.5v15H-2.5z'   fill='none'/>",width:20,height:20},{name:"plus",svg:"<path d='M1 4h6M4 1v6'  stroke-linecap='square'  fill='none'/>"}],this.figureData.xAxis={Axis:{"position-type":{type:"opt",optionList:["bottom","top"],value:0,isSvgAttr:!1},offset:{type:"seq",value:0,isSvgAttr:!1,scaleStep:1,min:-1/0,max:1/0},"scale-type":{type:"opt",optionList:["band","linear"],value:0,isSvgAttr:!1}},"Text style":{id:"xAxis-tick-text",switch:{type:"check",value:!0,isFresh:!0},rotate:{type:"seq",value:-45,isSvgAttr:!1,scaleStep:1,min:-1/0,max:1/0},"font-size":{type:"seq",value:16,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},fill:{type:"color",value:"#000000",isSvgAttr:!0},"font-weight":{type:"opt",optionList:["normal","bold"],value:0,isSvgAttr:!0},"text-anchor":{type:"opt",optionList:["start","middle","end"],value:2,isSvgAttr:!0},"font-style":{type:"opt",optionList:["normal","italic"],value:0,isSvgAttr:!0},offset:{type:"seq",value:-15,isSvgAttr:!1,scaleStep:1,min:-1/0,max:1/0}},Tick:{stroke:{type:"color",value:"#000000",isSvgAttr:!0},"stroke-width":{type:"seq",value:1,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},"stroke-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1},"tick-length":{type:"seq",value:6,isSvgAttr:!1,scaleStep:1,min:0,max:1/0},"tick-orientation":{type:"opt",optionList:["outside","inside"],value:0,isSvgAttr:!1},tickSizeOuter:{type:"check",value:!1,isFresh:!0},tickValues:{type:"text",value:"",isSvgAttr:!1,helpLink:"/static/help_book/XYAxis-like_plot/Axis/Tick.html#tickvalues"},tickFormat:{type:"text",value:"",isSvgAttr:!1,helpLink:"/static/help_book/XYAxis-like_plot/Axis/Tick.html"},removePath:{type:"check",value:!1,isFresh:!0},removeTick:{type:"check",value:!1,isFresh:!0}},Grid:{id:"xAxis-grid-line",switch:{type:"check",value:!1,isFresh:!0},stroke:{type:"color",value:"#000000",isSvgAttr:!0},"stroke-width":{type:"seq",value:1,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},"stroke-opacity":{type:"seq",value:.1,isSvgAttr:!0,scaleStep:.01,min:0,max:1}},Label:{id:"xAxis-label",text:{type:"text",value:"",isSvgAttr:!1,helpLink:"/static/help_book/XYAxis-like_plot/Axis/Lavel.html"},offset:{type:"seq",value:55,isSvgAttr:!1,scaleStep:1,min:-1/0,max:1/0},"font-size":{type:"seq",value:20,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},fill:{type:"color",value:"#000000",isSvgAttr:!0},"font-weight":{type:"opt",optionList:["normal","bold"],value:0,isSvgAttr:!0},"font-style":{type:"opt",optionList:["normal","italic"],value:0,isSvgAttr:!0}}},this.figureData.yAxis={Axis:{"position-type":{type:"opt",optionList:["left","right"],value:0,isSvgAttr:!1},offset:{type:"seq",value:0,isSvgAttr:!1,scaleStep:1,min:-1/0,max:1/0},"scale-type":{type:"opt",optionList:["linear","log2","log10"],value:0,isSvgAttr:!1}},"Text style":{id:"yAxis-tick-text",switch:{type:"check",value:!0,isFresh:!0},rotate:{type:"seq",value:0,isSvgAttr:!0,scaleStep:1,min:-1/0,max:1/0},"font-size":{type:"seq",value:16,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},fill:{type:"color",value:"#000000",isSvgAttr:!0},"font-weight":{type:"opt",optionList:["normal","bold"],value:0,isSvgAttr:!0},"text-anchor":{type:"opt",optionList:["start","middle","end"],value:2,isSvgAttr:!0},"font-style":{type:"opt",optionList:["normal","italic"],value:0,isSvgAttr:!0},offset:{type:"seq",value:10,isSvgAttr:!1,scaleStep:1,min:-1/0,max:1/0}},Tick:{stroke:{type:"color",value:"#000000",isSvgAttr:!0},"stroke-width":{type:"seq",value:1,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},"stroke-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1},"tick-length":{type:"seq",value:6,isSvgAttr:!1,scaleStep:1,min:0,max:1/0},"tick-orientation":{type:"opt",optionList:["outside","inside"],value:0,isSvgAttr:!1},tickSizeOuter:{type:"check",value:!1,isFresh:!0},tickValues:{type:"text",value:"",isSvgAttr:!1,helpLink:"/static/help_book/XYAxis-like_plot/Axis/Tick.html#tickvalues"},tickFormat:{type:"text",value:"",isSvgAttr:!1,helpLink:"/static/help_book/XYAxis-like_plot/Axis/Tick.html"},removePath:{type:"check",value:!1,isFresh:!0},removeTick:{type:"check",value:!1,isFresh:!0}},Grid:{id:"yAxis-grid-line",switch:{type:"check",value:!1,isFresh:!0},stroke:{type:"color",value:"#000000",isSvgAttr:!0},"stroke-width":{type:"seq",value:1,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},"stroke-opacity":{type:"seq",value:.1,isSvgAttr:!0,scaleStep:.01,min:0,max:1}},Label:{id:"yAxis-label",text:{type:"text",value:"",isSvgAttr:!1,helpLink:"/static/help_book/XYAxis-like_plot/Axis/Lavel.html"},y:{type:"seq",value:-55,isSvgAttr:!0,scaleStep:1,min:-1/0,max:1/0},"font-size":{type:"seq",value:20,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},fill:{type:"color",value:"#000000",isSvgAttr:!0},"font-weight":{type:"opt",optionList:["normal","bold"],value:0,isSvgAttr:!0},"font-style":{type:"opt",optionList:["normal","italic"],value:0,isSvgAttr:!0}}},this.figureData.title={Title:{switch:{type:"check",value:!1,isFresh:!0}},"Title text":{id:"title-text-style",text:{type:"text",value:"ChiPlot",isSvgAttr:!1,helpLink:"/static/help_book/XYAxis-like_plot/Axis/Lavel.html"},"font-size":{type:"seq",value:14,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},fill:{type:"color",value:"#000000",isSvgAttr:!0},"font-weight":{type:"opt",optionList:["normal","bold"],value:0,isSvgAttr:!0},"text-anchor":{type:"opt",optionList:["start","middle","end"],value:1,isSvgAttr:!0},"font-style":{type:"opt",optionList:["normal","italic"],value:0,isSvgAttr:!0},y:{type:"seq",value:0,isSvgAttr:!0,scaleStep:1,min:-1/0,max:1/0}},Background:{id:"title-background-rect-style",switch:{type:"check",value:!0,isFresh:!0},height:{type:"seq",value:30,isSvgAttr:!1,scaleStep:1,min:0,max:1/0},fill:{type:"color",value:"#ebebeb",isSvgAttr:!0},"fill-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1},stroke:{type:"color",value:"#000000",isSvgAttr:!0},"stroke-width":{type:"seq",value:1,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},"stroke-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1}}},this.figureData["right title"]={Title:{switch:{type:"check",value:!1,isFresh:!0}},"Title text":{id:"right-title-text-style",text:{type:"text",value:"ChiPlot",isSvgAttr:!1,helpLink:"/static/help_book/XYAxis-like_plot/Axis/Lavel.html"},"font-size":{type:"seq",value:14,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},fill:{type:"color",value:"#000000",isSvgAttr:!0},"font-weight":{type:"opt",optionList:["normal","bold"],value:0,isSvgAttr:!0},"text-anchor":{type:"opt",optionList:["start","middle","end"],value:1,isSvgAttr:!0},"font-style":{type:"opt",optionList:["normal","italic"],value:0,isSvgAttr:!0},x:{type:"seq",value:0,isSvgAttr:!0,scaleStep:1,min:-1/0,max:1/0}},Background:{id:"right-title-background-rect-style",switch:{type:"check",value:!0,isFresh:!0},width:{type:"seq",value:30,isSvgAttr:!1,scaleStep:1,min:0,max:1/0},fill:{type:"color",value:"#ebebeb",isSvgAttr:!0},"fill-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1},stroke:{type:"color",value:"#000000",isSvgAttr:!0},"stroke-width":{type:"seq",value:1,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},"stroke-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1}}},this.figureData.background={Background:{id:"background-rect-style",switch:{type:"check",value:!1,isFresh:!0},fill:{type:"color",value:"#ebebeb",isSvgAttr:!0},"fill-opacity":{type:"seq",value:1,isSvgAttr:!0,scaleStep:.01,min:0,max:1}}};let e={"color block of xAxis":function(t){let{dataSource:e,idSuffix:a,controlData:l,categoryList:r,otherData:i,legendDragData:s}=t;if(!this.datacheck([""]))return null;s.y=300,l={color:{"Color category":{color:{type:"button",value:"",iconClass:"cuIcon-file",event:"chooseColor"},"color gradient":{type:"button",value:"",iconClass:"cuIcon-similar",event:"chooseColorBar"}},"Custom color":{switch:{type:"check",value:!1,isFresh:!0}},"Color gradient":{switch:{type:"check",value:!1,isFresh:!0},reverse:{type:"check",value:!1,isFresh:!0}}},block:{block:{id:`color-block-rect-${a}`,y:{type:"seq",value:["heatmap","circleHeatmap"].includes(o.plotType)?-22:0,isSvgAttr:!1,min:-1/0,max:1/0,scaleStep:2},height:{type:"seq",value:20,isSvgAttr:!0,min:0,max:1/0,scaleStep:2},padding:{type:"seq",value:0,isSvgAttr:!1,min:0,max:1/0,scaleStep:1},stroke:{type:"color",value:"#000000",isSvgAttr:!0},"stroke-width":{type:"seq",value:0,isSvgAttr:!0,scaleStep:1,min:0,max:1/0}},text:{id:`color-block-text-${a}`,switch:{type:"check",value:!1,isFresh:!0},"font-size":{type:"seq",value:14,isSvgAttr:!0,scaleStep:1,min:0,max:1/0},fill:{type:"color",value:"#000000",isSvgAttr:!1},"fill-as-block":{type:"check",value:!1,isFresh:!0},"font-weight":{type:"opt",optionList:["normal","bold"],value:0,isSvgAttr:!0},"text-anchor":{type:"opt",optionList:["start","middle","end"],value:1,isSvgAttr:!0},"font-style":{type:"opt",optionList:["normal","italic"],value:0,isSvgAttr:!0},rotate:{type:"seq",value:0,isSvgAttr:!0,scaleStep:1,min:-1/0,max:1/0},y:{type:"seq",value:-5,isSvgAttr:!1,min:-1/0,max:1/0,scaleStep:1}}},legend:o.legendObj.getLegendControlData("baseCategoryLegend",a,t=>(t["Legend title"].text.value=e.columns[this.currentChenkedColumns[0]],t))},"circleHeatmap"==o.plotType&&(l.block.block.rotate={type:"seq",value:0,isSvgAttr:!1,scaleStep:1,min:-1/0,max:1/0});t=(a,i)=>{r=a.map(t=>{let e=i?t[a.columns[i.layerDataColumnsIndex[0]]]:t[a.columns[this.currentChenkedColumns[0]]];return null==e?e:e.toString()}).filter(t=>null!=t),r=Array.from(new Set(r)),console.log("99jjj",r),i&&(i.categoryList=r);let e={};e.switch=l.color["Custom color"].switch,r.forEach(t=>{t in l.color["Custom color"]?e[t]=l.color["Custom color"][t]:e[t]={type:"color",value:"#cccccc",isSvgAttr:!1}}),l.color["Custom color"]=e};return t(e),i.updateFunction=t,{controlData:l,categoryList:r,otherData:i,legendDragData:s}},"color block of yAxis":function(t){let{dataSource:e,idSuffix:a,controlData:l,categoryList:r,otherData:i,legendDragData:s}=t;if(!this.datacheck([""]))return null;console.log("legendDragData",s),s.y=420,l={color:{"Color category":{color:{type:"button",value:"",iconClass:"cuIcon-file",event:"chooseColor"},"color gradient":{type:"button",value:"",iconClass:"cuIcon-similar",event:"chooseColorBar"}},"Custom color":{switch:{type:"check",value:!1,isFresh:!0}},"Color gradient":{switch:{type:"check",value:!1,isFresh:!0},reverse:{type:"check",value:!1,isFresh:!0}}},block:{block:{id:`color-block-rect-${a}`,x:{type:"seq",value:-25,isSvgAttr:!1,min:-1/0,max:1/0,scaleStep:2},width:{type:"seq",value:20,isSvgAttr:!0,min:0,max:1/0,scaleStep:2},padding:{type:"seq",value:0,isSvgAttr:!1,min:0,max:1/0,scaleStep:1},stroke:{type:"color",value:"#000000",isSvgAttr:!0},"stroke-width":{type:"seq",value:0,isSvgAttr:!0,scaleStep:1,min:0,max:1/0}},text:{id:`${a}-color-block-text`,switch:{type:"check",value:!1,isFresh:!0},"font-size":{type:"seq",value:14,isSvgAttr:!0,scaleStep:.5,min:0,max:1/0},fill:{type:"color",value:"#000000",isSvgAttr:!1},"fill-as-block":{type:"check",value:!1,isFresh:!0},"font-weight":{type:"opt",optionList:["normal","bold"],value:0,isSvgAttr:!0},"font-style":{type:"opt",optionList:["normal","italic"],value:0,isSvgAttr:!0},"text-anchor":{type:"opt",optionList:["start","middle","end"],value:2,isSvgAttr:!0},rotate:{type:"seq",value:0,isSvgAttr:!0,scaleStep:1,min:-1/0,max:1/0},x:{type:"seq",value:0,isSvgAttr:!1,min:-1/0,max:1/0,scaleStep:1}}},legend:o.legendObj.getLegendControlData("baseCategoryLegend",a,t=>(t["Legend title"].text.value=e.columns[this.currentChenkedColumns[0]],t))},"circleHeatmap"==o.plotType&&(l.block.text.horizontal={type:"check",value:!1,isFresh:!0},delete l.block.text["text-anchor"],l.block.text.rotate.isSvgAttr=!1,l.block.block.width.isSvgAttr=!1);t=(a,i)=>{r=a.map(t=>{let e=i?t[a.columns[i.layerDataColumnsIndex[0]]]:t[a.columns[this.currentChenkedColumns[0]]];return null==e?e:e.toString()}).filter(t=>null!=t),r=Array.from(new Set(r)),console.log("99jjj",r),i&&(i.categoryList=r);let e={};e.switch=l.color["Custom color"].switch,r.forEach(t=>{t in l.color["Custom color"]?e[t]=l.color["Custom color"][t]:e[t]={type:"color",value:"#cccccc",isSvgAttr:!1}}),l.color["Custom color"]=e};return t(e),i.updateFunction=t,{controlData:l,categoryList:r,otherData:i,legendDragData:s}}};"string"!=typeof t&&t.forEach(t=>{this.layerComponent.addLayerType(t,e[t])})}drawTitle(){if(this.figureData.title.Title.switch.value){let e=this.figureData.title.Background.height.value;this.maingroup.append("g").attr("transform",`translate(0,${-e})`).call(t=>{this.figureData.title.Background.switch.value&&t.append("rect").attr("width",this.innerwidth).attr("height",e).attr("class",this.figureData.title.Background.id).call(t=>{this.renderAttr(t,this.figureData.title.Background)}),t.append("text").attr("transform",`translate(${this.innerwidth/2},${e/2})`).attr("dy","0.35em").attr("class",this.figureData.title["Title text"].id).call(t=>{this.renderAttr(t,this.figureData.title["Title text"]),this.renderText(t,this.figureData.title["Title text"].text.value)})})}if(this.figureData["right title"].Title.switch.value){let e=this.figureData["right title"],a=e.Background.width.value;this.maingroup.append("g").attr("transform",`translate(${this.innerwidth},0)`).call(t=>{e.Background.switch.value&&t.append("rect").attr("height",this.innerHeight).attr("width",a).attr("class",e.Background.id).call(t=>{this.renderAttr(t,e.Background)}),t.append("text").attr("transform",`translate(${a/2},${this.innerHeight/2})rotate(90)`).attr("dy","0.35em").attr("class",e["Title text"].id).call(t=>{this.renderAttr(t,e["Title text"]),this.renderText(t,e["Title text"].text.value)})})}}addAxis(){this.backgroundGroup=this.maingroup.append("g").lower().attr("id","background-group"),this.middleGroup=this.maingroup.append("g").attr("id","middleGroup-group"),this.figureData.background.Background.switch.value&&this.backgroundGroup.append("rect").attr("class",this.figureData.background.Background.id).attr("width",this.innerwidth).attr("height",this.innerHeight).call(t=>{this.renderAttr(t,this.figureData.background.Background)});var l=this.figureData.yAxis["Axis break"];if(l&&l.switch.value&&"l"==this.yScale.name){let t=l.start.value,e=l.end.value;var r=this.yScale(t)-this.yScale(e)-5,s=this.yScale(e)+r,o=this.yScale(t),r=this.innerHeight/(this.innerHeight-r);let a=this.yScale.domain()[1],i=this.yScale.domain()[0];this.yScale.domain([a,t,e,i].reverse()).range([0,this.innerHeight-(this.innerHeight-s)*r,this.innerHeight-(this.innerHeight-o)*r,this.innerHeight]).nice(),console.log(r),console.log(this.yScale.domain()),console.log(this.yScale.range())}o=this.figureData.xAxis.Axis["position-type"];let a="bottom"==o.optionList[o.value]?"axisBottom":"axisTop";r=this.figureData.xAxis.Axis.offset.value*("axisBottom"==a?1:-1);const e=d3[a](this.xScale).tickSizeOuter(this.figureData.xAxis.Tick.tickSizeOuter.value?-this.innerHeight:0),i=this.figureData.xAxis.Tick;if(i.hasOwnProperty("tickValues")&&i.tickValues.value&&e.tickValues(i.tickValues.value.split(",")),i.hasOwnProperty("tickFormat")&&i.tickFormat.value){let t=i.tickFormat.value;t.endsWith("E")&&(t=t.replace("E","e")),e.tickFormat(d3.format(t))}o=this.figureData.yAxis.Axis["position-type"];let c="left"==o.optionList[o.value]?"axisLeft":"axisRight";o=this.figureData.yAxis.Axis.offset.value*("axisLeft"==c?-1:1);const n=d3[c](this.yScale).tickSizeOuter(this.figureData.yAxis.Tick.tickSizeOuter.value?-this.innerwidth:0),h=this.figureData.yAxis.Tick;if(h.hasOwnProperty("tickValues")&&h.tickValues.value&&n.tickValues(h.tickValues.value.split(",")),l&&l.switch.value&&"l"==this.yScale.name){let e=l.start.value,a=l.end.value;n.tickValues()?n.tickValues(n.tickValues().filter(t=>t<e||t>a)):n.tickValues(this.yScale.ticks().filter(t=>t<e||t>a)),console.log("yAxis.tickValues()",n.tickValues())}if(h.hasOwnProperty("tickFormat")&&h.tickFormat.value){let t=h.tickFormat.value;t.endsWith("E")&&(t=t.replace("E","e")),n.tickFormat(d3.format(t))}const t=this.maingroup.append("g").call(e).attr("id","xAxis").attr("font-family",null).attr("transform",`translate(0,${r+("axisBottom"==a?this.innerHeight:0)})`),u=this.maingroup.append("g").call(n).attr("id","yAxis").attr("font-family",null);"axisRight"==c?(u.attr("transform",`translate(${o+this.innerwidth},0)`),this.figureData.yAxis["Text style"]["text-anchor"].value=0):(u.attr("transform",`translate(${o},0)`),this.figureData.yAxis["Text style"]["text-anchor"].value=2),this.xAxisGroup=t,this.yAxisGroup=u;let p=[{axis:"xAxis",axisGroup:t,axisDirection:a,axisTick:i,id:"xAxis-tick-text"},{axis:"yAxis",axisGroup:u,axisDirection:c,axisTick:h,id:"yAxis-tick-text"}];p.forEach(t=>{let{axis:e,axisGroup:a,axisDirection:i,axisTick:l}=t;console.log(i),a.selectAll(".tick text").remove();let r=this.figureData[e]["Text style"];r.switch.value&&(t=a.selectAll(".tick").append("g").attr("transform",t=>"xAxis"==e?`translate(0,${(["axisLeft","axisBottom"].includes(i)?-1:1)*r.offset.value})`:`translate(${(["axisLeft","axisBottom"].includes(i)?-1:1)*r.offset.value},0)`).append("text").text(t=>l.hasOwnProperty("tickFormat")&&l.tickFormat.value?d3.format(`${l.tickFormat.value}`)(t):t).attr("class",r.id).attr("dy","0.35em").attr("transform",t=>`rotate(${(["axisLeft","axisBottom"].includes(i)?1:-1)*r.rotate.value})`),l.hasOwnProperty("tickFormat")&&l.tickFormat.value.endsWith("E")&&a.selectAll(".tick text").call(t=>{this.valueFormat(t,l.tickFormat.value)}),this.renderAttr(t,r))});let d=t.append("text").attr("class",this.figureData.xAxis.Label.id).attr("text-anchor","middle").attr("x",this.innerwidth/2).attr("y",("axisBottom"==a?1:-1)*this.figureData.xAxis.Label.offset.value);this.renderAttr(d,this.figureData.xAxis.Label),d.call(t=>{var e=this.figureData.xAxis.Label.text.value;this.renderText(t,e)});let v=u.append("text").attr("class",this.figureData.yAxis.Label.id).attr("text-anchor","middle").attr("transform","rotate(-90)").attr("x",-this.innerHeight/2);this.renderAttr(v,this.figureData.yAxis.Label),v.call(t=>{var e=this.figureData.yAxis.Label.text.value;this.renderText(t,e)}),t.selectAll(".tick line").attr("class","tick-line").attr("y2",t=>{var e=i["tick-orientation"];return"outside"==e.optionList[e.value]?("axisBottom"==a?1:-1)*i["tick-length"].value:("axisBottom"==a?-1:1)*i["tick-length"].value}).call(t=>{this.renderAttr(t,i)}),t.selectAll(".domain").call(t=>{this.renderAttr(t,i)}),u.selectAll(".tick line").attr("class","tick-line").attr("x2",t=>{var e=h["tick-orientation"];return"outside"==e.optionList[e.value]?("axisLeft"==c?-1:1)*h["tick-length"].value:("axisLeft"==c?1:-1)*h["tick-length"].value}).call(t=>{this.renderAttr(t,h)}),u.selectAll(".domain").call(t=>{this.renderAttr(t,h)}),this.figureData.yAxis.Grid.switch.value&&(o=this.backgroundGroup.append("g").selectAll("line").data(u.selectAll(".tick line").data()).join("line").attr("class",this.figureData.yAxis.Grid.id).attr("y1",t=>this.yScale.bandwidth?this.yScale(t)+this.yScale.bandwidth()/2:this.yScale(t)).attr("y2",t=>this.yScale.bandwidth?this.yScale(t)+this.yScale.bandwidth()/2:this.yScale(t)).attr("x2",this.innerwidth),this.renderAttr(o,this.figureData.yAxis.Grid)),this.figureData.xAxis.Grid.switch.value&&(r=this.backgroundGroup.append("g").selectAll("line").data(t.selectAll(".tick line").data()).join("line").attr("class",this.figureData.xAxis.Grid.id).attr("x1",t=>this.xScale.bandwidth?this.xScale(t)+this.xScale.bandwidth()/2:this.xScale(t)).attr("x2",t=>this.xScale.bandwidth?this.xScale(t)+this.xScale.bandwidth()/2:this.xScale(t)).attr("y1","axisBottom"==a?0:r).attr("y2",this.innerHeight+("axisBottom"==a?r:0)),this.renderAttr(r,this.figureData.xAxis.Grid)),this.figureData.xAxis.Tick.removePath.value&&t.selectAll(".domain").remove(),this.figureData.yAxis.Tick.removePath.value&&u.selectAll(".domain").remove(),this.figureData.xAxis.Tick.removeTick.value&&t.selectAll(".tick .tick-line").remove(),this.figureData.yAxis.Tick.removeTick.value&&u.selectAll(".tick .tick-line").remove()}addPatternDefs(e){this.maingroup.append("defs").lower().selectAll("pattern").data(this.patternsSVGArr).join("pattern").attr("id",t=>`pattern-${t.name}`).attr("patternUnits","userSpaceOnUse").attr("width",t=>t.width||e.spacing.value).attr("height",t=>t.height||e.spacing.value).attr("class",e.id).attr("patternTransform",t=>t.patternTransform).html(t=>t.svg).call(t=>{this.renderAttr(t,e)})}drawXAxisColorBlock(){let t=this.layerPlaneData.layerStatistic["color block of xAxis"];t&&t.forEach((c,n)=>{let h=d3.scaleOrdinal().domain(c.categoryList).range(c.categoryColorList);if(c.isUseColorGradient&&h.range(d3.quantize(d3[c.colorInterpolate],h.domain().length)),c.controlData.color["Custom color"].switch.value&&h.range(c.categoryList.map(t=>c.controlData.color["Custom color"][t].value)),c.colorScale=h,this.maingroup.append("defs").selectAll(".gradient").data(c.categoryList).join("linearGradient").each(function(t,e){let a=d3.select(this);a.attr("id",t=>`cbox-${t.replaceAll(" ","_")}-${n}`).attr("x1","50%").attr("y1","100%").attr("x2","50%").attr("y2","0%"),a.append("stop").attr("offset","0%").attr("stop-color",t=>h(t)).attr("stop-opacity",c.controlData.color["Color gradient"].reverse.value?1:0),a.append("stop").attr("offset","50%").attr("stop-color",t=>h(t)).attr("stop-opacity",.3),a.append("stop").attr("offset","100%").attr("stop-color",t=>h(t)).attr("stop-opacity",c.controlData.color["Color gradient"].reverse.value?0:1)}),console.log(c.categoryColorList),c.isShowObj.isShow){let e=this.layerDataDict[c.layerDataFlieKey].dataSource.columns[c.layerDataColumnsIndex[0]],a=this.layerDataDict[c.layerDataFlieKey].dataIndex,i=this.xScale.domain().map(t=>a.has(t)?a.get(t)[e]:null),l=[],r="";i.forEach(function(t,e){t!=r&&(l.push({name:t,start:e,end:0}),0<=l.length-2&&(l[l.length-2].end=e-1)),r=t,e==i.length-1&&(l[l.length-1].end=e)}),console.log(l),l=l.filter(t=>null!=t.name);let t=this.maingroup.append("g").lower().attr("transform",t=>"heatmap"==this.plotType?`translate(0,${c.controlData.block.block.y.value})`:`translate(0,${this.innerHeight+c.controlData.block.block.y.value})`),s=this.innerwidth/i.length;c.controlData.block.block.height.value;let o=c.controlData.block.block.padding.value;t.selectAll("taxblock_t").data(l).join("rect").attr("class",c.controlData.block.block.id).attr("x",t=>t.start*s+o/2).attr("width",t=>(t.end-t.start+1)*s-o).call(t=>{c.controlData.color["Color gradient"].switch.value?t.attr("fill",t=>`url('#cbox-${t.name.replaceAll(" ","_")}-${n}')`):t.attr("fill",t=>h(t.name)),this.renderAttr(t,c.controlData.block.block)}),c.controlData.block.text.switch.value&&t.selectAll("taxblock_T").data(l).join("g").attr("transform",t=>`translate(${(t.start+t.end+1)/2*s},${c.controlData.block.text.y.value})`).append("text").attr("class",c.controlData.block.text.id).attr("fill",t=>c.controlData.block.text["fill-as-block"].value?h(t.name):c.controlData.block.text.fill.value).text(t=>t.name).call(t=>{this.renderAttr(t,c.controlData.block.text)})}})}drawYAxisColorBlock(){let t=this.layerPlaneData.layerStatistic["color block of yAxis"];t&&t.forEach((c,n)=>{let h=d3.scaleOrdinal().domain(c.categoryList).range(c.categoryColorList);if(c.isUseColorGradient&&h.range(d3.quantize(d3[c.colorInterpolate],h.domain().length)),c.controlData.color["Custom color"].switch.value&&h.range(c.categoryList.map(t=>c.controlData.color["Custom color"][t].value)),c.colorScale=h,this.maingroup.append("defs").selectAll(".gradient").data(c.categoryList).join("linearGradient").each(function(t,e){let a=d3.select(this);a.attr("id",t=>`cboy-${t.replaceAll(" ","_")}-${n}`).attr("x1","100%").attr("x2","0%").attr("y1","50%").attr("y2","50%"),a.append("stop").attr("offset","0%").attr("stop-color",t=>h(t)).attr("stop-opacity",c.controlData.color["Color gradient"].reverse.value?1:0),a.append("stop").attr("offset","50%").attr("stop-color",t=>h(t)).attr("stop-opacity",.3),a.append("stop").attr("offset","100%").attr("stop-color",t=>h(t)).attr("stop-opacity",c.controlData.color["Color gradient"].reverse.value?0:1)}),console.log(c.categoryColorList),c.isShowObj.isShow){let e=this.layerDataDict[c.layerDataFlieKey].dataSource.columns[c.layerDataColumnsIndex[0]],a=this.layerDataDict[c.layerDataFlieKey].dataIndex,i=this.yScale.domain().map(t=>a.has(t)?a.get(t)[e]:null);console.log(i);let l=[],r="";i.forEach(function(t,e){t!=r&&(l.push({name:t,start:e,end:0}),0<=l.length-2&&(l[l.length-2].end=e-1)),r=t,e==i.length-1&&(l[l.length-1].end=e)}),console.log(l),l=l.filter(t=>null!=t.name);let t=this.maingroup.append("g").lower().attr("transform",`translate(${c.controlData.block.block.x.value},0)`),s=this.innerHeight/i.length;c.controlData.block.block.width.value;let o=c.controlData.block.block.padding.value;t.selectAll("taxblock_t").data(l).join("rect").attr("class",c.controlData.block.block.id).attr("y",t=>t.start*s+o/2).attr("height",t=>(t.end-t.start+1)*s-o).call(t=>{c.controlData.color["Color gradient"].switch.value?t.attr("fill",t=>`url('#cboy-${t.name.replaceAll(" ","_")}-${n}')`):t.attr("fill",t=>h(t.name)),this.renderAttr(t,c.controlData.block.block)}),c.controlData.block.text.switch.value&&t.selectAll("taxblock_T").data(l).join("g").attr("transform",t=>`translate(${c.controlData.block.text.x.value},${(t.start+t.end+1)/2*s})`).append("text").attr("class",c.controlData.block.text.id).attr("fill",t=>c.controlData.block.text["fill-as-block"].value?h(t.name):c.controlData.block.text.fill.value).attr("dy",".3em").text(t=>t.name).call(t=>{this.renderAttr(t,c.controlData.block.text)})}})}drawAxisBreakRect(){var t,e=this.figureData.yAxis["Axis break"];e&&e.switch.value&&"l"==this.yScale.name&&(t=e.start.value,e=e.end.value,this.maingroup.append("rect").attr("y",this.yScale(e)).attr("x",-3).attr("width",this.innerwidth+6).attr("height",this.yScale(t)-this.yScale(e)).attr("fill","#ffffff"),this.figureData.yAxis.Tick.removePath.value||(this.maingroup.append("g").attr("transform",`translate(0,${this.yScale(e)})rotate(45)`).append("line").attr("x1",-8).attr("x2",8).call(t=>{this.renderAttr(t,this.figureData.yAxis.Tick)}),this.maingroup.append("g").attr("transform",`translate(0,${this.yScale(t)})rotate(45)`).append("line").attr("x1",-8).attr("x2",8).call(t=>{this.renderAttr(t,this.figureData.yAxis.Tick)})))}drawLegend(){let t=this.layerPlaneData.layerStatistic["color block of xAxis"];t&&t.forEach(t=>{console.log(t),t.isShowObj.isShow&&t.colorScale&&this.legendObj.drawBaseCategoryLegend(t.controlData.legend,t.colorScale.domain(),t.colorScale,t.legendDragData)});let e=this.layerPlaneData.layerStatistic["color block of yAxis"];e&&e.forEach(t=>{console.log(t),t.isShowObj.isShow&&t.colorScale&&this.legendObj.drawBaseCategoryLegend(t.controlData.legend,t.colorScale.domain(),t.colorScale,t.legendDragData)})}starCount(t,e=4){let a=0;return t<=.05&&.01<t?a=1:t<=.01&&0<t?a=parseInt(Math.log10(1/t)):0==t&&(a=e),a>e?e:a}}function addAxis(l){let{maingroup:t,yAxisDirection:a,xAxisDirection:i,controlData:s,suffix:e,yScale:r,xScale:o,innerWidth:c,innerHeight:n,mainPlot:h}=l,u=t.append("g").lower().attr("id",`background-group-${e}`);var p=t.append("g").attr("id",`middleGroup-group-${e}`);s.background.Background.switch.value&&u.append("rect").attr("class",s.background.Background.id).attr("width",c).attr("height",n).call(t=>{h.renderAttr(t,s.background.Background)});var d=s.yAxis["Axis break"];if(d&&d.switch.value&&"l"==r.name){let t=d.start.value,e=d.end.value;var v=r(t)-r(e)-5,g=r(e)+v,l=r(t),v=n/(n-v);let a=r.domain()[1],i=r.domain()[0];r.domain([a,t,e,i].reverse()).range([0,n-(n-g)*v,n-(n-l)*v,n]).nice(),console.log(v),console.log(r.domain()),console.log(r.range())}const x=d3[i](o).tickSizeOuter(s.xAxis.Tick.tickSizeOuter.value?-n:0),m=s.xAxis.Tick;m.hasOwnProperty("tickValues")&&m.tickValues.value&&x.tickValues(m.tickValues.value.split(",")),m.hasOwnProperty("tickFormat")&&m.tickFormat.value&&x.tickFormat(d3.format(`.${m.tickFormat.value}f`));const y=d3[a](r).tickSizeOuter(s.yAxis.Tick.tickSizeOuter.value?-c:0),k=s.yAxis.Tick;if(k.hasOwnProperty("tickValues")&&k.tickValues.value&&y.tickValues(k.tickValues.value.split(",")),d&&d.switch.value&&"l"==r.name){let e=d.start.value,a=d.end.value;y.tickValues()?y.tickValues(y.tickValues().filter(t=>t<e||t>a)):y.tickValues(r.ticks().filter(t=>t<e||t>a)),console.log("yAxis.tickValues()",y.tickValues())}k.hasOwnProperty("tickFormat")&&k.tickFormat.value&&y.tickFormat(d3.format(k.tickFormat.value));const A=t.append("g").call(x).attr("id",`xAxis-${e}`);"axisBottom"==i&&A.attr("transform",`translate(0,${n})`);const f=t.append("g").call(y).attr("id",`yAxis-${e}`);"axisRight"==a?(f.attr("transform",`translate(${c},0)`),s.yAxis["Text style"]["text-anchor"].value=0):s.yAxis["Text style"]["text-anchor"].value=2;let S=[{axis:"xAxis",axisGroup:A,axisDirection:i,axisTick:m},{axis:"yAxis",axisGroup:f,axisDirection:a,axisTick:k}];S.forEach(t=>{let{axis:e,axisGroup:a,axisDirection:i,axisTick:l}=t;a.selectAll(".tick text").remove();let r=s[t.axis]["Text style"];r.switch.value&&(t=a.selectAll(".tick").append("g").attr("transform",t=>"xAxis"==e?`translate(0,${(["axisLeft","axisBottom"].includes(i)?-1:1)*r.offset.value})`:`translate(${(["axisLeft","axisBottom"].includes(i)?-1:1)*r.offset.value},0)`).append("text").text(t=>l.hasOwnProperty("tickFormat")&&l.tickFormat.value?d3.format(`${l.tickFormat.value}`)(t):t).attr("class",r.id).attr("dy","0.35em").attr("transform",t=>`rotate(${(["axisLeft","axisBottom"].includes(i)?1:-1)*r.rotate.value})`),l.hasOwnProperty("tickFormat")&&l.tickFormat.value.endsWith("E")&&a.selectAll(".tick text").call(t=>{h.valueFormat(t,l.tickFormat.value)}),h.renderAttr(t,r))});d=A.append("text").attr("class",s.xAxis.Label.id).attr("text-anchor","middle").attr("x",c/2);h.renderAttr(d,s.xAxis.Label);var b,d=f.append("text").attr("class",s.yAxis.Label.id).attr("text-anchor","middle").attr("transform","rotate(-90)").attr("x",-n/2);return h.renderAttr(d,s.yAxis.Label),A.selectAll(".tick line").attr("class","tick-line").attr("y2",t=>{var e=m["tick-orientation"];return"outside"==e.optionList[e.value]?("axisBottom"==i?1:-1)*m["tick-length"].value:("axisBottom"==i?-1:1)*m["tick-length"].value}).call(t=>{h.renderAttr(t,m)}),A.selectAll(".domain").call(t=>{h.renderAttr(t,m)}),f.selectAll(".tick line").attr("class","tick-line").attr("x2",t=>{var e=k["tick-orientation"];return"outside"==e.optionList[e.value]?("axisLeft"==a?-1:1)*k["tick-length"].value:("axisLeft"==a?1:-1)*k["tick-length"].value}).call(t=>{h.renderAttr(t,k)}),f.selectAll(".domain").call(t=>{h.renderAttr(t,k)}),s.yAxis.Grid.switch.value&&(b=u.append("g").selectAll("line").data(f.selectAll(".tick line").data()).join("line").attr("class",s.yAxis.Grid.id).attr("y1",t=>r.bandwidth?r(t)+r.bandwidth()/2:r(t)).attr("y2",t=>r.bandwidth?r(t)+r.bandwidth()/2:r(t)).attr("x2",c),h.renderAttr(b,s.yAxis.Grid)),s.xAxis.Grid.switch.value&&(b=u.append("g").selectAll("line").data(A.selectAll(".tick line").data()).join("line").attr("class",s.xAxis.Grid.id).attr("x1",t=>o.bandwidth?o(t)+o.bandwidth()/2:o(t)).attr("x2",t=>o.bandwidth?o(t)+o.bandwidth()/2:o(t)).attr("y2",n),h.renderAttr(b,s.xAxis.Grid)),s.xAxis.Tick.removePath.value&&A.selectAll(".domain").remove(),s.yAxis.Tick.removePath.value&&f.selectAll(".domain").remove(),s.xAxis.Tick.removeTick.value&&A.selectAll(".tick .tick-line").remove(),s.yAxis.Tick.removeTick.value&&f.selectAll(".tick .tick-line").remove(),{xAxisGroup:A,yAxisGroup:f,middleGroup:p}}export{XYPlot,addAxis};